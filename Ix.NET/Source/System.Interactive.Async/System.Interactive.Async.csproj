<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <Description>Interactive Extensions Async Library used to express queries over asynchronous enumerable sequences.</Description>
    <AssemblyTitle>Interactive Extensions - Async Library</AssemblyTitle>

    <!--
    .NET 10.0 gets its own target because that doesn't need a transitive reference
    to System.Linq.AsyncEnumerable - it's built in from .NET 10.0 and later -
    but all other targets do need that reference.
    Even though we support back to .NET 8.0 for v7, we don't build targets for
    any versions older than net10.0 because net8.0 and net9.0 are both covered
    by the netstandard2.0 target.
    -->
    <TargetFrameworks>net48;netstandard2.0;netstandard2.1;net6.0;net10.0</TargetFrameworks>
    <PackageTags>Ix;Interactive;Extensions;Enumerable;Asynchronous</PackageTags>
  </PropertyGroup>

  <PropertyGroup>
    <!-- IDE0305 wants to turn things like list.ToArray into [..list], which we don't find to be an improvement in readability. -->
    <NoWarn>$(NoWarn);IDE0305</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="..\System.Linq.Async\System\Error.cs" Link="System\Error.cs" />
    <Compile Include="..\System.Linq.Async\System\Linq\AsyncIterator.cs" Link="System\Linq\AsyncIterator.cs" />
    <Compile Include="..\System.Linq.Async\System\Linq\Set.cs" Link="System\Linq\Set.cs" />
    <Compile Include="..\System.Linq.Async\System\Strings.cs" Link="System\Strings.cs" />
    <Compile Include="..\System.Linq.Async\System\Threading\Tasks\AsyncEnumerableExt.cs" Link="System\Threading\Tasks\AsyncEnumerableExt.cs" />
  </ItemGroup>

  <ItemGroup>
    <EmbeddedResource Include="Properties\System.Interactive.Async.rd.xml" />
  </ItemGroup>

  <!--
  Incorporate the reference assemblies. Note that these have a different set of TFMs from the proper assemblies.
  
  See ../../Documentation/adr/0001-Ix-Ref-Assembly-Mismatches.md
  -->
  <ItemGroup>
    <None Include="../refs/System.Interactive.Async/bin/$(Configuration)/$(TargetFramework)/System.Interactive.Async.*" PackagePath="ref/$(TargetFramework)" Pack="true" />
  </ItemGroup>
  
  <!--
  These warnings occur because we are deliberately creating a lib/ref mismatch. There doesn't seem to be
  an official way to do that, so we have to suppress the warnings.
  
  See ../../Documentation/adr/0001-Ix-Ref-Assembly-Mismatches.md for an explanation of this bizarreness.
  -->

  <PropertyGroup>
    <!--
    NU5128: lib/ref mismatch. This is deliberate, as explained in the ADR.
    NU5131: spurious missing file errors. It appears that the build is confused by what we're doing.
    -->
    <NoWarn>$(NoWarn);NU5128;NU5131</NoWarn>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetFramework)' != 'net10.0'">
    <PackageReference Include="System.Linq.AsyncEnumerable" Version="10.0.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\System.Linq.Async.SourceGenerator\System.Linq.Async.SourceGenerator.csproj" OutputItemType="Analyzer" ReferenceOutputAssembly="false" Private="false" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="System\Linq\Operators\Average.Generated.cs">
      <DependentUpon>Average.Generated.tt</DependentUpon>
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <None Update="System\Linq\Operators\Average.Generated.tt">
      <LastGenOutput>Average.Generated.cs</LastGenOutput>
      <Generator>TextTemplatingFileGenerator</Generator>
    </None>
  </ItemGroup>

  <ItemGroup>
    <Service Include="{508349b6-6b84-4df5-91f0-309beebad82d}" />
  </ItemGroup>

</Project>
